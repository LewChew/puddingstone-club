<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puddingstone Club - Little Compton's Premier Social Supper Club</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #003366;      /* Deep Navy Blue */
            --secondary-color: #0066CC;    /* Ocean Blue */
            --accent-color: #DC143C;       /* Crimson Red */
            --text-dark: #1a1a2e;          /* Dark Navy */
            --text-light: #4a5568;         /* Slate Gray */
            --bg-light: #F0F4F8;           /* Light Blue-Gray */
            --bg-white: #FFFFFF;           /* White */
            --border-color: #B8C5D6;       /* Light Navy */
            --success-color: #2E8B57;      /* Sea Green */
            --hover-color: #E6F0FF;        /* Light Sky Blue */
            --gold-accent: #DAA520;        /* Nautical Gold */
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 3px solid var(--accent-color);
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: repeating-linear-gradient(
                90deg,
                var(--accent-color) 0px,
                var(--accent-color) 20px,
                white 20px,
                white 40px
            );
        }

        .header-content {
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.1rem;
            font-style: italic;
            opacity: 0.95;
        }

        /* Navigation */
        nav {
            background-color: var(--bg-white);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--accent-color);
            background-color: var(--hover-color);
        }

        /* Sections */
        .section {
            padding: 3rem 0;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .section-title::after {
            content: '⚓';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        /* Welcome Section */
        .welcome-content {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent-color);
            border-right: 4px solid var(--secondary-color);
        }

        .welcome-content p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        /* Scheduler Section */
        .scheduler-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .month-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .month-selector button {
            background: var(--secondary-color);
            color: white;
            border: 2px solid var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .month-selector button:hover {
            background: var(--primary-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        #currentMonth {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            min-width: 200px;
            text-align: center;
        }

        /* Calendar Grid */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 2rem;
        }

        .calendar-header {
            font-weight: bold;
            text-align: center;
            padding: 0.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 5px;
            border: 1px solid var(--accent-color);
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: white;
        }

        .calendar-day:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .calendar-day.other-month {
            opacity: 0.3;
            cursor: default;
        }

        .calendar-day.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--accent-color), 0 0 0 4px var(--primary-color);
        }

        .day-number {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .availability-count {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: var(--success-color);
        }

        .calendar-day.selected .availability-count {
            color: white;
        }

        /* Member Availability */
        .member-input {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-left: 3px solid var(--secondary-color);
        }

        .member-input h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-group input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn {
            background: var(--accent-color);
            color: white;
            border: 2px solid var(--primary-color);
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: var(--primary-color);
            border-color: var(--gold-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .selected-dates {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 5px;
            min-height: 50px;
        }

        .selected-date-tag {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            margin: 0.25rem;
            font-size: 0.9rem;
            border: 1px solid var(--primary-color);
        }

        /* Results Section */
        .results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .results h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .result-item {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--bg-light);
            border-radius: 5px;
            border-left: 4px solid var(--accent-color);
            border-right: 2px solid var(--secondary-color);
        }

        .result-date {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .result-members {
            margin-top: 0.5rem;
            color: var(--text-light);
        }

        .member-list {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-top: 3px solid var(--accent-color);
            border-bottom: 3px solid var(--secondary-color);
        }

        .member-list h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .member-name {
            font-weight: 500;
        }

        .remove-member {
            background: var(--accent-color);
            color: white;
            border: 1px solid var(--primary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .remove-member:hover {
            background: var(--primary-color);
            border-color: var(--gold-accent);
            transform: translateY(-1px);
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
            font-style: italic;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left-color: #ff4444;
        }

        .notification.warning {
            border-left-color: #ff9800;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-icon {
            font-size: 1.5rem;
        }

        .notification-message {
            flex: 1;
            color: var(--text-dark);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--primary-color), var(--text-dark));
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem;
            border-top: 3px solid var(--accent-color);
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: repeating-linear-gradient(
                90deg,
                var(--accent-color) 0px,
                var(--accent-color) 20px,
                var(--secondary-color) 20px,
                var(--secondary-color) 40px
            );
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .calendar {
                gap: 5px;
            }

            .calendar-day {
                font-size: 0.9rem;
            }

            .nav-links {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>⚓ Puddingstone Club ⚓</h1>
                <p class="tagline">Little Compton's Premier Social Supper Club</p>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul class="nav-links">
                <li><a href="#" data-section="welcome" class="active">Welcome</a></li>
                <li><a href="#" data-section="scheduler">Event Scheduler</a></li>
                <li><a href="#" data-section="members">Members</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- Welcome Section -->
        <section id="welcome" class="section active">
            <h2 class="section-title">Welcome to Puddingstone Club</h2>
            <div class="welcome-content">
                <p>Welcome to Little Compton's most cherished gathering of food enthusiasts and friends. The Puddingstone Club brings together busy professionals and families who share a passion for exceptional cuisine, warm conversation, and the irreplaceable joy of communal dining.</p>
                <p>Our intimate group of members meets regularly for carefully curated supper events, where the menu is matched only by the quality of the company. Despite our demanding schedules, we make time for what matters most: good food and great friendship.</p>
                <p>Use our scheduling tool to help coordinate our next memorable evening together.</p>
            </div>
        </section>

        <!-- Scheduler Section -->
        <section id="scheduler" class="section">
            <h2 class="section-title">Event Scheduler</h2>
            <div class="scheduler-container">
                <div class="member-input">
                    <h3>Submit Your Availability</h3>
                    <div class="input-group">
                        <label for="memberName" class="sr-only">Your Name</label>
                        <input type="text" id="memberName" placeholder="Enter your name" aria-label="Your name" autocomplete="name" maxlength="50">
                        <button class="btn" onclick="setMemberName()" aria-label="Set your name">Set Name</button>
                    </div>
                    <div class="selected-dates" id="selectedDates" role="status" aria-live="polite">
                        <span class="empty-state">Click on calendar dates to select your available days</span>
                    </div>
                    <button class="btn" onclick="submitAvailability()" style="margin-top: 1rem;" aria-label="Submit your availability">Submit Availability</button>
                </div>

                <div class="month-selector">
                    <button onclick="changeMonth(-1)" aria-label="Previous month">← Previous</button>
                    <span id="currentMonth" role="heading" aria-level="3"></span>
                    <button onclick="changeMonth(1)" aria-label="Next month">Next →</button>
                </div>

                <div class="calendar" id="calendar" role="grid" aria-label="Calendar for date selection"></div>

                <div class="results" id="results">
                    <h3>⚓ Best Dates for Next Gathering ⚓</h3>
                    <div id="resultsList" role="region" aria-live="polite">
                        <p class="empty-state">No availability submitted yet. Members can select their available dates above.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Members Section -->
        <section id="members" class="section">
            <h2 class="section-title">Club Members</h2>
            <div class="member-list">
                <h3>Current Members</h3>
                <div id="membersList">
                    <p class="empty-state">No members have submitted availability yet.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Puddingstone Club - Little Compton, Rhode Island</p>
            <p>Where busy lives pause for exceptional gatherings</p>
        </div>
    </footer>

    <script>
        // Configuration Constants
        const CONFIG = {
            MIN_MEMBERS_FOR_RESULTS: 2,
            MAX_RESULTS_TO_SHOW: 5,
            CALENDAR_DAYS: 42,
            MAX_NAME_LENGTH: 50
        };

        // Application State
        let currentMonth = new Date();
        let selectedDates = [];
        let currentMemberName = '';
        let memberAvailability = {};

        // Utility Functions
        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        function validateMemberName(name) {
            if (!name || typeof name !== 'string') {
                return { valid: false, error: 'Please enter your name' };
            }

            const trimmedName = name.trim();

            if (trimmedName.length === 0) {
                return { valid: false, error: 'Please enter your name' };
            }

            if (trimmedName.length > CONFIG.MAX_NAME_LENGTH) {
                return { valid: false, error: `Name must be ${CONFIG.MAX_NAME_LENGTH} characters or less` };
            }

            if (!/^[a-zA-Z\s\-'.]+$/.test(trimmedName)) {
                return { valid: false, error: 'Name can only contain letters, spaces, hyphens, apostrophes, and periods' };
            }

            return { valid: true, name: trimmedName };
        }

        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            const icons = {
                success: '✓',
                error: '✕',
                warning: '⚠'
            };

            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-icon">${icons[type] || icons.success}</div>
                    <div class="notification-message">${sanitizeHTML(message)}</div>
                </div>
            `;

            document.body.appendChild(notification);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Navigation
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionName = link.dataset.section;
                
                // Update active nav
                document.querySelectorAll('.nav-links a').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                // Show section
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(sectionName).classList.add('active');
            });
        });

        // Calendar Functions
        function initCalendar() {
            updateMonthDisplay();
            renderCalendar();
            loadStoredData();
        }

        function updateMonthDisplay() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
        }

        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            updateMonthDisplay();
            renderCalendar();
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Get first day of month
            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Generate calendar days
            for (let i = 0; i < CONFIG.CALENDAR_DAYS; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                if (date.getMonth() !== currentMonth.getMonth()) {
                    dayDiv.classList.add('other-month');
                } else {
                    dayDiv.onclick = () => toggleDate(date);
                    
                    // Check if date is selected
                    const dateStr = formatDate(date);
                    if (selectedDates.includes(dateStr)) {
                        dayDiv.classList.add('selected');
                    }
                    
                    // Add availability count
                    const availCount = getAvailabilityCount(dateStr);
                    if (availCount > 0) {
                        const countSpan = document.createElement('div');
                        countSpan.className = 'availability-count';
                        countSpan.textContent = `${availCount} available`;
                        dayDiv.appendChild(countSpan);
                    }
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = date.getDate();
                dayDiv.insertBefore(dayNumber, dayDiv.firstChild);
                
                calendar.appendChild(dayDiv);
            }
        }

        function formatDate(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function toggleDate(date) {
            const dateStr = formatDate(date);
            const index = selectedDates.indexOf(dateStr);
            
            if (index === -1) {
                selectedDates.push(dateStr);
            } else {
                selectedDates.splice(index, 1);
            }
            
            renderCalendar();
            updateSelectedDatesDisplay();
        }

        function updateSelectedDatesDisplay() {
            const container = document.getElementById('selectedDates');
            
            if (selectedDates.length === 0) {
                container.innerHTML = '<span class="empty-state">Click on calendar dates to select your available days</span>';
            } else {
                container.innerHTML = selectedDates.sort().map(date => {
                    const d = new Date(date);
                    const options = { weekday: 'short', month: 'short', day: 'numeric' };
                    return `<span class="selected-date-tag">${d.toLocaleDateString('en-US', options)}</span>`;
                }).join('');
            }
        }

        function setMemberName() {
            const input = document.getElementById('memberName');
            const validation = validateMemberName(input.value);

            if (!validation.valid) {
                showNotification(validation.error, 'error');
                return;
            }

            currentMemberName = validation.name;
            showNotification(`Name set to: ${currentMemberName}`, 'success');
        }

        function submitAvailability() {
            if (!currentMemberName) {
                showNotification('Please enter your name first', 'error');
                return;
            }

            if (selectedDates.length === 0) {
                showNotification('Please select at least one available date', 'error');
                return;
            }

            // Store availability
            memberAvailability[currentMemberName] = [...selectedDates];

            if (!saveToLocalStorage()) {
                showNotification('Failed to save availability. Please try again.', 'error');
                return;
            }

            // Clear selection
            selectedDates = [];
            document.getElementById('memberName').value = '';
            currentMemberName = '';

            updateSelectedDatesDisplay();
            updateResults();
            updateMembersList();
            renderCalendar();

            showNotification('Availability submitted successfully!', 'success');
        }

        function getAvailabilityCount(dateStr) {
            let count = 0;
            for (const member in memberAvailability) {
                if (memberAvailability[member].includes(dateStr)) {
                    count++;
                }
            }
            return count;
        }

        function updateResults() {
            const resultsDiv = document.getElementById('resultsList');
            
            if (Object.keys(memberAvailability).length === 0) {
                resultsDiv.innerHTML = '<p class="empty-state">No availability submitted yet. Members can select their available dates above.</p>';
                return;
            }
            
            // Aggregate availability
            const dateAggregation = {};
            for (const member in memberAvailability) {
                memberAvailability[member].forEach(date => {
                    if (!dateAggregation[date]) {
                        dateAggregation[date] = [];
                    }
                    dateAggregation[date].push(member);
                });
            }
            
            // Sort by number of available members
            const sortedDates = Object.entries(dateAggregation)
                .sort((a, b) => b[1].length - a[1].length || a[0].localeCompare(b[0]))
                .filter(([date, members]) => members.length >= CONFIG.MIN_MEMBERS_FOR_RESULTS);
            
            if (sortedDates.length === 0) {
                resultsDiv.innerHTML = '<p class="empty-state">No dates have multiple members available yet.</p>';
                return;
            }
            
            // Display top dates
            resultsDiv.innerHTML = sortedDates.slice(0, CONFIG.MAX_RESULTS_TO_SHOW).map(([date, members]) => {
                const d = new Date(date);
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const sanitizedMembers = members.map(m => sanitizeHTML(m)).join(', ');
                return `
                    <div class="result-item">
                        <div class="result-date">${d.toLocaleDateString('en-US', options)}</div>
                        <div class="result-members">${members.length} members available: ${sanitizedMembers}</div>
                    </div>
                `;
            }).join('');
        }

        function updateMembersList() {
            const membersDiv = document.getElementById('membersList');
            const members = Object.keys(memberAvailability);
            
            if (members.length === 0) {
                membersDiv.innerHTML = '<p class="empty-state">No members have submitted availability yet.</p>';
                return;
            }
            
            membersDiv.innerHTML = members.map((member, index) => {
                const sanitizedMember = sanitizeHTML(member);
                return `
                    <div class="member-item">
                        <span class="member-name">${sanitizedMember}</span>
                        <button class="remove-member" data-member-index="${index}">Remove</button>
                    </div>
                `;
            }).join('');

            // Add event listeners to remove buttons
            membersDiv.querySelectorAll('.remove-member').forEach((button, index) => {
                button.addEventListener('click', () => removeMember(members[index]));
            });
        }

        function removeMember(memberName) {
            const sanitizedName = sanitizeHTML(memberName);
            showNotification(`Remove ${sanitizedName} and their availability?`, 'warning');

            // Create a temporary confirmation system
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = 'Confirm';
                confirmBtn.className = 'btn';
                confirmBtn.style.marginTop = '10px';
                confirmBtn.style.padding = '0.5rem 1rem';
                confirmBtn.style.fontSize = '0.9rem';

                confirmBtn.onclick = () => {
                    delete memberAvailability[memberName];
                    if (!saveToLocalStorage()) {
                        showNotification('Failed to save changes. Please try again.', 'error');
                        return;
                    }
                    updateResults();
                    updateMembersList();
                    renderCalendar();
                    showNotification(`${sanitizedName} has been removed`, 'success');
                };

                existingNotification.querySelector('.notification-content').appendChild(confirmBtn);
            }
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('puddingstoneAvailability', JSON.stringify(memberAvailability));
                return true;
            } catch (error) {
                console.error('Failed to save to localStorage:', error);
                return false;
            }
        }

        function loadStoredData() {
            try {
                const stored = localStorage.getItem('puddingstoneAvailability');
                if (stored) {
                    memberAvailability = JSON.parse(stored);
                    updateResults();
                    updateMembersList();
                    renderCalendar();
                }
            } catch (error) {
                console.error('Failed to load from localStorage:', error);
                showNotification('Failed to load saved data. Starting fresh.', 'warning');
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initCalendar);
    </script>
</body>
</html>