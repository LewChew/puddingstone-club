<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puddingstone Club - Little Compton's Premier Social Supper Club</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #003366;      /* Deep Navy Blue */
            --secondary-color: #0066CC;    /* Ocean Blue */
            --accent-color: #DC143C;       /* Crimson Red */
            --text-dark: #1a1a2e;          /* Dark Navy */
            --text-light: #4a5568;         /* Slate Gray */
            --bg-light: #F0F4F8;           /* Light Blue-Gray */
            --bg-white: #FFFFFF;           /* White */
            --border-color: #B8C5D6;       /* Light Navy */
            --success-color: #2E8B57;      /* Sea Green */
            --hover-color: #E6F0FF;        /* Light Sky Blue */
            --gold-accent: #DAA520;        /* Nautical Gold */
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 3px solid var(--accent-color);
            position: relative;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: repeating-linear-gradient(
                90deg,
                var(--accent-color) 0px,
                var(--accent-color) 20px,
                white 20px,
                white 40px
            );
        }

        .header-content {
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.1rem;
            font-style: italic;
            opacity: 0.95;
        }

        /* Navigation */
        nav {
            background-color: var(--bg-white);
            border-bottom: 2px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--accent-color);
            background-color: var(--hover-color);
        }

        /* Sections */
        .section {
            padding: 3rem 0;
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            padding-bottom: 1rem;
        }

        .section-title::after {
            content: '‚öì';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        /* Welcome Section */
        .welcome-content {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border-left: 4px solid var(--accent-color);
            border-right: 4px solid var(--secondary-color);
        }

        .welcome-content p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        /* Scheduler Section */
        .scheduler-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .month-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .month-selector button {
            background: var(--secondary-color);
            color: white;
            border: 2px solid var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 600;
        }

        .month-selector button:hover {
            background: var(--primary-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        #currentMonth {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-color);
            min-width: 200px;
            text-align: center;
        }

        /* Calendar Grid */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 2rem;
        }

        .calendar-header {
            font-weight: bold;
            text-align: center;
            padding: 0.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 5px;
            border: 1px solid var(--accent-color);
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: white;
        }

        .calendar-day:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .calendar-day.other-month {
            opacity: 0.3;
            cursor: default;
        }

        .calendar-day.selected {
            background: var(--accent-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--accent-color), 0 0 0 4px var(--primary-color);
        }

        .day-number {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .availability-count {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            color: var(--success-color);
        }

        .calendar-day.selected .availability-count {
            color: white;
        }

        /* Member Availability */
        .member-input {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-left: 3px solid var(--secondary-color);
        }

        .member-input h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-group input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .btn {
            background: var(--accent-color);
            color: white;
            border: 2px solid var(--primary-color);
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: var(--primary-color);
            border-color: var(--gold-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .selected-dates {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 5px;
            min-height: 50px;
        }

        .selected-date-tag {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            margin: 0.25rem;
            font-size: 0.9rem;
            border: 1px solid var(--primary-color);
        }

        /* Results Section */
        .results {
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }

        .results h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .result-item {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--bg-light);
            border-radius: 5px;
            border-left: 4px solid var(--accent-color);
            border-right: 2px solid var(--secondary-color);
        }

        .result-date {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .result-members {
            margin-top: 0.5rem;
            color: var(--text-light);
        }

        .member-list {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-top: 3px solid var(--accent-color);
            border-bottom: 3px solid var(--secondary-color);
        }

        .member-list h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .member-name {
            font-weight: 500;
        }

        .remove-member {
            background: var(--accent-color);
            color: white;
            border: 1px solid var(--primary-color);
            padding: 0.25rem 0.75rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .remove-member:hover {
            background: var(--primary-color);
            border-color: var(--gold-accent);
            transform: translateY(-1px);
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Event Proposal Section */
        .event-proposal-intro {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--secondary-color);
            text-align: center;
        }

        .event-proposal-intro p {
            color: var(--text-light);
            margin: 0;
        }

        .event-proposal-form-container {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 3px solid var(--accent-color);
        }

        .event-proposal-form-container h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .event-proposal-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .proposed-events-section {
            margin-top: 3rem;
            padding: 2rem;
            background: var(--bg-light);
            border-radius: 8px;
            border-top: 3px solid var(--accent-color);
        }

        .proposed-events-section h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .event-card {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .event-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .event-card-header h4 {
            color: var(--primary-color);
            margin: 0 0 0.5rem 0;
            font-size: 1.3rem;
        }

        .event-proposer {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .event-status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .event-status-badge.confirmed {
            background: var(--success-color);
            color: white;
        }

        .event-status-badge.pending {
            background: var(--gold-accent);
            color: white;
        }

        .event-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 5px;
        }

        .event-detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .event-detail-item strong {
            color: var(--primary-color);
        }

        .event-ideas {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            border-left: 3px solid var(--secondary-color);
        }

        .event-ideas p {
            margin: 0;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .event-rsvp-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .event-rsvp-section h5 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .rsvp-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .rsvp-actions button {
            flex: 1;
        }

        .btn-attending {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-attending:hover {
            background: #246d43;
            border-color: var(--gold-accent);
        }

        .btn-maybe {
            background: var(--gold-accent);
            border-color: var(--gold-accent);
        }

        .btn-maybe:hover {
            background: #b8860b;
            border-color: var(--primary-color);
        }

        .btn-cant-attend {
            background: #888;
            border-color: #666;
        }

        .btn-cant-attend:hover {
            background: #666;
        }

        .attendee-list {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }

        .attendee-list h6 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .attendee-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .attendee-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            background: var(--success-color);
            color: white;
        }

        .attendee-tag.maybe {
            background: var(--gold-accent);
        }

        .counter-proposal-section {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--hover-color);
            border-radius: 5px;
            border-left: 3px solid var(--secondary-color);
        }

        .counter-proposal-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .counter-proposal-form input {
            padding: 0.5rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .counter-proposal-list {
            margin-top: 1rem;
        }

        .counter-proposal-item {
            padding: 0.75rem;
            background: white;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--secondary-color);
        }

        .email-helper-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--hover-color);
            border-radius: 5px;
            border: 2px dashed var(--secondary-color);
        }

        .email-helper-section p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .email-list-display {
            background: white;
            padding: 0.75rem;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            border: 1px solid var(--border-color);
            word-break: break-all;
        }

        /* Photo Carousel */
        .carousel-container {
            margin-top: 3rem;
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .carousel {
            position: relative;
            max-width: 900px;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 8px;
            background: var(--bg-light);
        }

        .carousel-inner {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
        }

        .carousel-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carousel-item.active {
            opacity: 1;
            z-index: 1;
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
            background: var(--bg-dark);
        }

        .carousel-placeholder {
            text-align: center;
            color: var(--text-light);
            padding: 2rem;
        }

        .carousel-placeholder p:first-child {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .carousel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 51, 102, 0.7);
            color: white;
            border: none;
            font-size: 2rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            z-index: 2;
        }

        .carousel-control:hover {
            background: var(--primary-color);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-control.prev {
            left: 1rem;
        }

        .carousel-control.next {
            right: 1rem;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .carousel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .carousel-indicator.active {
            background: var(--accent-color);
            width: 30px;
            border-radius: 6px;
        }

        .carousel-indicator:hover {
            background: var(--secondary-color);
        }

        /* Photo Gallery */
        .gallery-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .gallery-intro {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-light);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 4 / 3;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: var(--bg-dark);
        }

        .gallery-item-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gallery-item:hover .gallery-item-caption {
            opacity: 1;
        }

        .gallery-placeholder {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
            background: var(--bg-light);
            border-radius: 8px;
            border: 2px dashed var(--border-color);
        }

        /* Photo Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .lightbox-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
        }

        .lightbox-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--accent-color);
            color: white;
            border: none;
            font-size: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lightbox-close:hover {
            background: var(--primary-color);
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .counter-proposal-form {
                grid-template-columns: 1fr;
            }

            .event-details {
                grid-template-columns: 1fr;
            }

            .rsvp-actions {
                flex-direction: column;
            }

            .photo-grid {
                grid-template-columns: 1fr;
            }

            .carousel-control {
                padding: 0.5rem 1rem;
                font-size: 1.5rem;
            }
        }

        /* Membership Request Section */
        .membership-request-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .request-intro {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid var(--secondary-color);
        }

        .request-intro p {
            margin-bottom: 0.75rem;
            color: var(--text-light);
        }

        .request-intro p:last-child {
            margin-bottom: 0;
        }

        .request-form-container {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        .request-form-container h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .request-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            font-family: 'Georgia', serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .char-counter {
            display: block;
            text-align: right;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .btn-large {
            width: 100%;
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Authentication Section */
        .auth-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--secondary-color);
        }

        .auth-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: none;
            color: var(--text-light);
            font-size: 1rem;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .auth-tab:hover {
            color: var(--primary-color);
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--accent-color);
            font-weight: bold;
        }

        .auth-form h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .auth-form label {
            display: block;
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* Admin Section */
        .admin-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent-color);
        }

        .admin-auth {
            max-width: 500px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--bg-light);
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--secondary-color);
        }

        .admin-auth h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .admin-auth p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        .admin-panel {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
        }

        .admin-panel h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .request-card {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .request-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .request-card p {
            margin-bottom: 0.5rem;
            color: var(--text-light);
        }

        .request-card .request-message {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-style: italic;
            border-left: 3px solid var(--secondary-color);
        }

        .request-card .request-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .request-card .request-actions button {
            flex: 1;
        }

        .btn-approve {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-approve:hover {
            background: #246d43;
            border-color: var(--gold-accent);
        }

        .btn-deny {
            background: #888;
            border-color: #666;
        }

        .btn-deny:hover {
            background: #666;
            border-color: var(--text-dark);
        }

        .approved-member-card {
            background: white;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 8px;
            border-left: 4px solid var(--success-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .approved-member-card .member-info h4 {
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .approved-member-card .member-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .request-meta {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
            font-style: italic;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left-color: #ff4444;
        }

        .notification.warning {
            border-left-color: #ff9800;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-icon {
            font-size: 1.5rem;
        }

        .notification-message {
            flex: 1;
            color: var(--text-dark);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--primary-color), var(--text-dark));
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem;
            border-top: 3px solid var(--accent-color);
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: repeating-linear-gradient(
                90deg,
                var(--accent-color) 0px,
                var(--accent-color) 20px,
                var(--secondary-color) 20px,
                var(--secondary-color) 40px
            );
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .calendar {
                gap: 5px;
            }

            .calendar-day {
                font-size: 0.9rem;
            }

            .nav-links {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
    </style>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1>‚öì Puddingstone Club ‚öì</h1>
                <p class="tagline">Little Compton's Premier Social Supper Club</p>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul class="nav-links">
                <li><a href="#" data-section="welcome" class="active">Welcome</a></li>
                <li><a href="#" data-section="scheduler">Event Scheduler</a></li>
                <li><a href="#" data-section="gallery">Gallery</a></li>
                <li><a href="#" data-section="members">Members</a></li>
                <li><a href="#" data-section="request">Request Membership</a></li>
                <li id="adminNavItem" style="display: none;"><a href="#" data-section="admin">Admin</a></li>
                <li id="loginNavItem"><a href="#" data-section="auth">Login</a></li>
                <li id="signoutNavItem" style="display: none;"><a href="#" onclick="signOut(); return false;">Sign Out</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- Welcome Section -->
        <section id="welcome" class="section active">
            <h2 class="section-title">Welcome to Puddingstone Club</h2>
            <div class="welcome-content">
                <p>Welcome to Little Compton's most cherished gathering of food enthusiasts and friends. The Puddingstone Club brings together busy professionals and families who share a passion for exceptional cuisine, warm conversation, and the irreplaceable joy of communal dining.</p>
                <p>Our intimate group of members meets regularly for carefully curated supper events, where the menu is matched only by the quality of the company. Despite our demanding schedules, we make time for what matters most: good food and great friendship.</p>
                <p>Use our scheduling tool to help coordinate our next memorable evening together.</p>
            </div>

            <!-- Photo Carousel -->
            <div class="carousel-container">
                <h3 style="text-align: center; color: var(--primary-color); margin-bottom: 1.5rem;">‚öì The Stones ‚öì</h3>
                <div class="carousel" id="photoCarousel">
                    <div class="carousel-inner" id="carouselInner">
                        <div class="carousel-item active">
                            <div class="carousel-placeholder">
                                <p>üì∏</p>
                                <p>Add photos via Admin panel</p>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control prev" onclick="moveCarousel(-1)" aria-label="Previous photo">‚Äπ</button>
                    <button class="carousel-control next" onclick="moveCarousel(1)" aria-label="Next photo">‚Ä∫</button>
                    <div class="carousel-indicators" id="carouselIndicators"></div>
                </div>
            </div>
        </section>

        <!-- Scheduler Section -->
        <section id="scheduler" class="section">
            <h2 class="section-title">Propose an Event</h2>
            <div class="scheduler-container">
                <!-- Logged Out Message -->
                <div id="eventSchedulerLoggedOut" class="event-proposal-intro" style="display: none;">
                    <div style="background: var(--bg-white); padding: 2rem; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 3px solid var(--secondary-color);">
                        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">‚öì Members Only Feature</h3>
                        <p style="font-size: 1rem; margin-bottom: 1rem;">Event scheduling is available exclusively to Puddingstone Club members.</p>
                        <p style="color: var(--text-light); margin-bottom: 1.5rem;">Join our community to propose gatherings, view upcoming events, and coordinate with fellow members.</p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <a href="#" onclick="document.querySelector('[data-section=request]').click(); return false;" class="btn btn-large" style="text-decoration: none;">Request Membership</a>
                            <a href="#" onclick="document.querySelector('[data-section=auth]').click(); return false;" class="btn" style="text-decoration: none; background: var(--bg-white); color: var(--primary-color); border: 2px solid var(--primary-color);">Already a Member? Sign In</a>
                        </div>
                    </div>
                </div>

                <!-- Logged In Content -->
                <div id="eventSchedulerLoggedIn" style="display: none;">
                    <div class="event-proposal-intro">
                        <p><strong>Welcome!</strong> Propose events and coordinate with other members. Your proposals will be shared with all club members.</p>
                    </div>

                    <div class="event-proposal-form-container">
                    <h3>‚öì Create Event Proposal</h3>
                    <div id="proposerInfo" style="background: var(--hover-color); padding: 0.75rem 1rem; border-radius: 5px; margin-bottom: 1rem; border-left: 3px solid var(--secondary-color); display: none;">
                        <p style="margin: 0; font-size: 0.9rem; color: var(--text-dark);">
                            <strong>Proposing as:</strong> <span id="proposerNameDisplay"></span>
                        </p>
                    </div>
                    <form id="eventProposalForm" class="event-proposal-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventDate">Proposed Date *</label>
                                <input type="date" id="eventDate" name="eventDate" required aria-label="Event date">
                            </div>
                            <div class="form-group">
                                <label for="eventTime">Proposed Time *</label>
                                <input type="time" id="eventTime" name="eventTime" required aria-label="Event time">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventLocation">Location</label>
                                <input type="text" id="eventLocation" name="eventLocation" maxlength="100" placeholder="e.g., My house, Restaurant name" aria-label="Event location">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="eventIdeas">Event Ideas/Theme *</label>
                            <textarea id="eventIdeas" name="eventIdeas" rows="4" required maxlength="300" placeholder="Describe your ideas for this gathering (cuisine, theme, activity, etc.)" aria-label="Event ideas"></textarea>
                            <small class="char-counter"><span id="eventCharCount">0</span>/300 characters</small>
                        </div>

                        <button type="submit" class="btn btn-large">Propose Event & Notify Members</button>
                    </form>
                </div>

                    <div class="proposed-events-section">
                        <h3>‚öì Proposed Events</h3>
                        <div id="proposedEventsList">
                            <p class="empty-state">No events proposed yet. Be the first to suggest a gathering!</p>
                        </div>
                    </div>
                </div>
                <!-- End Logged In Content -->
            </div>
        </section>

        <!-- Gallery Section -->
        <section id="gallery" class="section">
            <h2 class="section-title">Photo Gallery</h2>
            <div class="gallery-container">
                <div class="gallery-intro" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <p style="flex: 1;">Memories from our gatherings, celebrations, and culinary adventures together.</p>
                    <button id="uploadPhotoBtn" class="btn" onclick="showPhotoUploadModal()" style="display: none;">
                        üì∏ Upload Photo
                    </button>
                </div>
                <div class="photo-grid" id="photoGallery">
                    <div class="gallery-placeholder">
                        <p style="font-size: 3rem; margin-bottom: 1rem;">üì∏</p>
                        <p>No photos yet</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">Members can upload photos for admin approval</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Photo Upload Modal -->
        <div id="photoUploadModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 500px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="color: var(--primary-color); margin: 0;">üì∏ Upload Photo</h3>
                    <button onclick="closePhotoUploadModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light);">√ó</button>
                </div>

                <form id="photoUploadForm" onsubmit="handlePhotoUpload(event)">
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="photoFile" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select Photo *</label>
                        <input type="file" id="photoFile" accept="image/*" required style="width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 5px;">
                        <small style="color: var(--text-light); display: block; margin-top: 0.5rem;">Accepted formats: JPG, PNG, GIF (max 5MB)</small>
                    </div>

                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label for="photoUploadCaption" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Caption (Optional)</label>
                        <textarea id="photoUploadCaption" rows="3" maxlength="200" placeholder="Add a caption to your photo..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 5px; resize: vertical;"></textarea>
                        <small style="color: var(--text-light);"><span id="captionCharCount">0</span>/200 characters</small>
                    </div>

                    <div id="photoPreview" style="margin-bottom: 1rem; display: none;">
                        <img id="photoPreviewImg" src="" alt="Preview" style="max-width: 100%; border-radius: 8px; border: 2px solid var(--border-color);">
                    </div>

                    <div style="background: var(--hover-color); padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
                        <p style="font-size: 0.9rem; color: var(--text-dark); margin: 0;">
                            ‚ÑπÔ∏è Your photo will be reviewed by an admin before appearing in the gallery.
                        </p>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="button" onclick="closePhotoUploadModal()" class="btn" style="flex: 1; background: var(--bg-white); color: var(--primary-color); border: 2px solid var(--primary-color);">Cancel</button>
                        <button type="submit" class="btn btn-large" style="flex: 1;">Upload Photo</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Members Section -->
        <section id="members" class="section">
            <h2 class="section-title">Club Members</h2>
            <div class="member-list">
                <h3>‚öì Approved Members</h3>
                <div id="membersListDisplay">
                    <p class="empty-state">No approved members yet.</p>
                </div>
            </div>
        </section>

        <!-- Request Membership Section -->
        <section id="request" class="section">
            <h2 class="section-title">Request Membership</h2>
            <div class="membership-request-container">
                <div class="request-intro">
                    <p>Interested in joining our exclusive gathering of food enthusiasts? We'd love to hear from you! Please fill out the form below to request membership in the Puddingstone Club.</p>
                    <p>Our members will review your request and get back to you soon.</p>
                </div>

                <div class="request-form-container">
                    <h3>‚öì Membership Application</h3>
                    <form id="membershipRequestForm" class="request-form">
                        <div class="form-group">
                            <label for="requestName">Full Name *</label>
                            <input type="text" id="requestName" name="requestName" required maxlength="50" aria-label="Your full name">
                        </div>

                        <div class="form-group">
                            <label for="requestEmail">Email Address *</label>
                            <input type="email" id="requestEmail" name="requestEmail" required maxlength="100" aria-label="Your email address">
                        </div>

                        <div class="form-group">
                            <label for="requestPhone">Phone Number</label>
                            <input type="tel" id="requestPhone" name="requestPhone" maxlength="20" aria-label="Your phone number">
                        </div>

                        <div class="form-group">
                            <label for="requestMessage">Why would you like to join the Puddingstone Club? *</label>
                            <textarea id="requestMessage" name="requestMessage" rows="5" required maxlength="500" aria-label="Your message"></textarea>
                            <small class="char-counter"><span id="charCount">0</span>/500 characters</small>
                        </div>

                        <button type="submit" class="btn btn-large">Submit Membership Request</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Authentication Section -->
        <section id="auth" class="section">
            <h2 class="section-title">Member Login</h2>
            <div id="authSection" class="auth-container">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="showAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="showAuthTab('signup')">Sign Up</button>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="auth-form" style="display: block;">
                    <h3>Welcome Back</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Sign in to access the event scheduler and member features.</p>

                    <form onsubmit="handleLogin(event)">
                        <div class="input-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" required placeholder="your@email.com">
                        </div>

                        <div class="input-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" required placeholder="Enter your password">
                        </div>

                        <button type="submit" class="btn btn-large">Sign In</button>
                    </form>
                </div>

                <!-- Signup Form -->
                <div id="signupForm" class="auth-form" style="display: none;">
                    <h3>Join the Club</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Create an account to participate in events and connect with members.</p>

                    <form onsubmit="handleSignup(event)">
                        <div class="input-group">
                            <label for="signupName">Full Name</label>
                            <input type="text" id="signupName" required placeholder="John Doe">
                        </div>

                        <div class="input-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" required placeholder="your@email.com">
                        </div>

                        <div class="input-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" required placeholder="Choose a strong password" minlength="6">
                        </div>

                        <div class="input-group">
                            <label for="signupPasswordConfirm">Confirm Password</label>
                            <input type="password" id="signupPasswordConfirm" required placeholder="Confirm your password" minlength="6">
                        </div>

                        <button type="submit" class="btn btn-large">Create Account</button>

                        <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 1rem;">
                            By creating an account, you agree to be part of the Puddingstone Club community.
                        </p>
                    </form>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin" class="section">
            <h2 class="section-title">Admin Panel</h2>
            <div class="admin-container">
                <div class="admin-auth" id="adminAuth">
                    <h3>üîê Admin Access Required</h3>
                    <p>This section is only accessible to club administrators.</p>
                    <p style="margin-top: 1rem;">Please <a href="#" onclick="document.querySelector('[data-section=auth]').click(); return false;" style="color: var(--accent-color); text-decoration: underline; font-weight: bold;">sign in</a> with your admin account to access the management panel.</p>
                </div>

                <div class="admin-panel" id="adminPanel" style="display: none;">
                    <h3>‚öì Membership Requests</h3>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Review and manage membership applications. Approved members can create accounts and access member features.</p>
                    <div id="pendingRequests">
                        <p class="empty-state">No pending membership requests.</p>
                    </div>

                    <div class="admin-actions" style="margin-top: 2rem;">
                        <h3>‚öì Pending Photo Approvals</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Review and approve photos uploaded by members before they appear in the gallery.</p>
                        <div id="pendingPhotos">
                            <p class="empty-state">No pending photos.</p>
                        </div>
                    </div>

                    <div class="admin-actions" style="margin-top: 2rem;">
                        <h3>‚öì Registered Members</h3>
                        <p style="color: var(--text-light); margin-bottom: 1rem;">Current club members with active accounts.</p>
                        <div id="approvedMembers">
                            <p class="empty-state">No registered members yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Photo Lightbox -->
    <div class="lightbox" id="photoLightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
            <img id="lightboxImage" src="" alt="Full size photo">
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 Puddingstone Club - Little Compton, Rhode Island</p>
            <p>Where busy lives pause for exceptional gatherings</p>
        </div>
    </footer>

    <script>
        // Configuration Constants
        const CONFIG = {
            MIN_MEMBERS_FOR_RESULTS: 2,
            MAX_RESULTS_TO_SHOW: 5,
            CALENDAR_DAYS: 42,
            MAX_NAME_LENGTH: 50,
            SUPABASE_URL: 'https://mnvauyzewzjqndildgqu.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1udmF1eXpld3pqcW5kaWxkZ3F1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NjI3ODEsImV4cCI6MjA3OTEzODc4MX0.JUCEESdhwnzqt2jv6VnLJzqEPSni0XPHefRWJveOKXk'
        };

        // Initialize Supabase Client
        const supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        // Application State
        let currentUser = null;
        let currentUserProfile = null;
        let membershipRequests = [];
        let approvedMembers = [];
        let isAdminLoggedIn = false;
        let proposedEvents = [];
        let currentUserName = '';
        let clubPhotos = [];
        let photoCaptions = {}; // Store captions separately {filename: caption}
        let currentCarouselIndex = 0;
        let carouselInterval = null;

        // Photo file list - update this when adding photos to assets/photos/
        // Note: HEIC format not supported in browsers - convert to JPG/JPEG before uploading
        const PHOTO_FILES = [
            'AmishBabes.JPG',
            'BeachBums.jpeg',
            'BoatDrinks.jpeg',
            // 'BoysNKitchen.heic', // HEIC not supported in browsers
            'ChrisSpeach.jpeg',
            'ChriswithBlue.jpeg',
            'LadiesAtNight.jpeg',
            'LadiesStraws.jpeg',
            'LadiesSunset.jpeg',
            'MerLinds.jpeg',
            'OutstandingGentsJPG.JPG',
            'PeacePeace.jpeg',
            'RagePeace.jpeg',
            'TimSpeaks.jpeg',
            'firepit.jpeg',
            'funMeme.jpg',
            'leatherback.jpg',
        ];

        // Utility Functions
        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        function validateMemberName(name) {
            if (!name || typeof name !== 'string') {
                return { valid: false, error: 'Please enter your name' };
            }

            const trimmedName = name.trim();

            if (trimmedName.length === 0) {
                return { valid: false, error: 'Please enter your name' };
            }

            if (trimmedName.length > CONFIG.MAX_NAME_LENGTH) {
                return { valid: false, error: `Name must be ${CONFIG.MAX_NAME_LENGTH} characters or less` };
            }

            if (!/^[a-zA-Z\s\-'.]+$/.test(trimmedName)) {
                return { valid: false, error: 'Name can only contain letters, spaces, hyphens, apostrophes, and periods' };
            }

            return { valid: true, name: trimmedName };
        }

        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†'
            };

            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-icon">${icons[type] || icons.success}</div>
                    <div class="notification-message">${sanitizeHTML(message)}</div>
                </div>
            `;

            document.body.appendChild(notification);

            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Authentication Functions
        async function checkAuthSession() {
            const { data: { session }, error } = await supabase.auth.getSession();

            if (error) {
                console.error('Error getting session:', error);
                return null;
            }

            if (session) {
                currentUser = session.user;
                await loadUserProfile();
                updateUIForAuthState();
            }

            return session;
        }

        async function loadUserProfile() {
            if (!currentUser) return;

            const { data, error } = await supabase
                .from('user_profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();

            if (error) {
                console.error('Error loading user profile:', error);
                return;
            }

            currentUserProfile = data;
            currentUserName = data.name;
            isAdminLoggedIn = data.is_admin;
        }

        async function signIn(email, password) {
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                throw error;
            }

            currentUser = data.user;
            await loadUserProfile();
            updateUIForAuthState();

            return data;
        }

        async function signOut() {
            const { error } = await supabase.auth.signOut();

            if (error) {
                throw error;
            }

            currentUser = null;
            currentUserProfile = null;
            currentUserName = '';
            isAdminLoggedIn = false;

            updateUIForAuthState();
        }

        async function signUp(email, password, name) {
            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        name: name
                    }
                }
            });

            if (error) {
                throw error;
            }

            return data;
        }

        function updateUIForAuthState() {
            const authSection = document.getElementById('authSection');
            const adminAuthSection = document.getElementById('adminAuth');
            const adminPanel = document.getElementById('adminPanel');
            const loginNavItem = document.getElementById('loginNavItem');
            const signoutNavItem = document.getElementById('signoutNavItem');
            const adminNavItem = document.getElementById('adminNavItem');
            const proposerInfo = document.getElementById('proposerInfo');
            const proposerNameDisplay = document.getElementById('proposerNameDisplay');
            const eventSchedulerLoggedIn = document.getElementById('eventSchedulerLoggedIn');
            const eventSchedulerLoggedOut = document.getElementById('eventSchedulerLoggedOut');

            if (currentUser) {
                // User is logged in
                if (authSection) authSection.style.display = 'none';

                // Show sign out, hide login in nav
                if (loginNavItem) loginNavItem.style.display = 'none';
                if (signoutNavItem) signoutNavItem.style.display = 'block';

                // Show event scheduler content, hide logged out message
                if (eventSchedulerLoggedIn) eventSchedulerLoggedIn.style.display = 'block';
                if (eventSchedulerLoggedOut) eventSchedulerLoggedOut.style.display = 'none';

                // Show proposer info on event form
                if (proposerInfo) proposerInfo.style.display = 'block';
                if (proposerNameDisplay) proposerNameDisplay.textContent = currentUserName;

                // Show photo upload button
                const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
                if (uploadPhotoBtn) uploadPhotoBtn.style.display = 'block';

                // Admin panel access
                if (isAdminLoggedIn) {
                    if (adminNavItem) adminNavItem.style.display = 'block';
                    if (adminAuthSection) adminAuthSection.style.display = 'none';
                    if (adminPanel) adminPanel.style.display = 'block';
                } else {
                    if (adminNavItem) adminNavItem.style.display = 'none';
                    if (adminAuthSection) adminAuthSection.style.display = 'block';
                    if (adminPanel) adminPanel.style.display = 'none';
                }
            } else {
                // User is logged out
                if (authSection) authSection.style.display = 'block';
                if (loginNavItem) loginNavItem.style.display = 'block';
                if (signoutNavItem) signoutNavItem.style.display = 'none';
                if (adminNavItem) adminNavItem.style.display = 'none';
                if (adminAuthSection) adminAuthSection.style.display = 'block';
                if (adminPanel) adminPanel.style.display = 'none';
                if (proposerInfo) proposerInfo.style.display = 'none';

                // Show logged out message, hide event scheduler form
                if (eventSchedulerLoggedOut) eventSchedulerLoggedOut.style.display = 'block';
                if (eventSchedulerLoggedIn) eventSchedulerLoggedIn.style.display = 'none';

                // Hide photo upload button
                const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
                if (uploadPhotoBtn) uploadPhotoBtn.style.display = 'none';
            }
        }

        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                currentUser = session.user;
                loadUserProfile().then(() => {
                    updateUIForAuthState();
                    showNotification('Successfully signed in!', 'success');
                });
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                currentUserProfile = null;
                currentUserName = '';
                isAdminLoggedIn = false;
                updateUIForAuthState();
                showNotification('Successfully signed out!', 'success');
            }
        });

        // Auth Form Handlers
        function showAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const tabs = document.querySelectorAll('.auth-tab');

            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                tabs[0].classList.add('active');
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                tabs[1].classList.add('active');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await signIn(email, password);
                showNotification('Welcome back!', 'success');

                // Clear form
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';

                // Navigate to scheduler
                document.querySelector('[data-section="scheduler"]').click();
            } catch (error) {
                console.error('Login error:', error);
                showNotification(error.message || 'Login failed. Please check your credentials.', 'error');
            }
        }

        async function handleSignup(event) {
            event.preventDefault();

            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;

            if (password !== passwordConfirm) {
                showNotification('Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }

            try {
                await signUp(email, password, name);
                showNotification('Account created! Please check your email to verify your account.', 'success');

                // Clear form
                document.getElementById('signupName').value = '';
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
                document.getElementById('signupPasswordConfirm').value = '';

                // Switch to login tab
                showAuthTab('login');
            } catch (error) {
                console.error('Signup error:', error);
                showNotification(error.message || 'Signup failed. Please try again.', 'error');
            }
        }

        // Navigation
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionName = link.dataset.section;
                
                // Update active nav
                document.querySelectorAll('.nav-links a').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                // Show section
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(sectionName).classList.add('active');
            });
        });

        // Event Proposal Functions
        function initEventProposalForm() {
            const form = document.getElementById('eventProposalForm');
            const ideasField = document.getElementById('eventIdeas');
            const charCount = document.getElementById('eventCharCount');

            // Character counter
            if (ideasField) {
                ideasField.addEventListener('input', () => {
                    charCount.textContent = ideasField.value.length;
                });
            }

            // Form submission
            if (form) {
                form.addEventListener('submit', handleEventProposal);
            }

            // Set minimum date to today
            const dateInput = document.getElementById('eventDate');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.setAttribute('min', today);
            }
        }

        function handleEventProposal(e) {
            e.preventDefault();

            // Check if user is logged in
            if (!currentUser || !currentUserName) {
                showNotification('You must be logged in to propose an event.', 'error');
                // Navigate to login
                document.querySelector('[data-section="auth"]').click();
                return;
            }

            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value.trim();
            const ideas = document.getElementById('eventIdeas').value.trim();

            // Create event object
            const event = {
                id: Date.now(),
                proposer: currentUserName,
                proposer_id: currentUser.id,
                date: date,
                time: time,
                location: location || 'TBD',
                ideas: ideas,
                timestamp: new Date().toISOString(),
                attendees: [],
                counterProposals: []
            };

            // Add to events array
            proposedEvents.push(event);

            // Save to localStorage
            if (!saveEventsData()) {
                showNotification('Failed to propose event. Please try again.', 'error');
                return;
            }

            // Clear form
            document.getElementById('eventProposalForm').reset();
            document.getElementById('eventCharCount').textContent = '0';

            // Refresh display
            displayProposedEvents();

            // Show success with email helper
            showNotification('Event proposed successfully! Check below for notification details.', 'success');

            // Show email notification helper
            showEmailNotificationHelper(event);
        }

        function displayProposedEvents() {
            const container = document.getElementById('proposedEventsList');

            if (proposedEvents.length === 0) {
                container.innerHTML = '<p class="empty-state">No events proposed yet. Be the first to suggest a gathering!</p>';
                return;
            }

            // Sort by date (newest first)
            const sortedEvents = [...proposedEvents].sort((a, b) =>
                new Date(b.timestamp) - new Date(a.timestamp)
            );

            container.innerHTML = sortedEvents.map(event => renderEventCard(event)).join('');
        }

        function renderEventCard(event) {
            const eventDate = new Date(event.date + 'T' + event.time);
            const dateStr = eventDate.toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            const sanitizedProposer = sanitizeHTML(event.proposer);
            const sanitizedLocation = sanitizeHTML(event.location);
            const sanitizedIdeas = sanitizeHTML(event.ideas);

            const attending = event.attendees.filter(a => a.status === 'attending');
            const maybe = event.attendees.filter(a => a.status === 'maybe');

            return `
                <div class="event-card">
                    <div class="event-card-header">
                        <div>
                            <h4>${dateStr} at ${event.time}</h4>
                            <p class="event-proposer">Proposed by ${sanitizedProposer}</p>
                        </div>
                        <span class="event-status-badge ${attending.length >= 3 ? 'confirmed' : 'pending'}">
                            ${attending.length >= 3 ? 'Looking Good!' : 'Pending'}
                        </span>
                    </div>

                    <div class="event-details">
                        <div class="event-detail-item">
                            <strong>üìç Location:</strong> ${sanitizedLocation}
                        </div>
                        <div class="event-detail-item">
                            <strong>üë• Attending:</strong> ${attending.length}
                        </div>
                        <div class="event-detail-item">
                            <strong>‚ùì Maybe:</strong> ${maybe.length}
                        </div>
                    </div>

                    <div class="event-ideas">
                        <strong>Event Ideas:</strong>
                        <p>${sanitizedIdeas}</p>
                    </div>

                    <div class="event-rsvp-section">
                        <h5>Your RSVP:</h5>
                        <div class="rsvp-actions">
                            <button class="btn btn-attending" onclick="rsvpToEvent(${event.id}, 'attending')">
                                ‚úì I'll Be There
                            </button>
                            <button class="btn btn-maybe" onclick="rsvpToEvent(${event.id}, 'maybe')">
                                ‚ùì Maybe
                            </button>
                            <button class="btn btn-cant-attend" onclick="rsvpToEvent(${event.id}, 'cant-attend')">
                                ‚úï Can't Make It
                            </button>
                        </div>

                        ${renderAttendeeList(event)}
                        ${renderCounterProposalSection(event)}
                    </div>
                </div>
            `;
        }

        function renderAttendeeList(event) {
            const attending = event.attendees.filter(a => a.status === 'attending');
            const maybe = event.attendees.filter(a => a.status === 'maybe');

            if (attending.length === 0 && maybe.length === 0) {
                return '<p style="color: var(--text-light); font-style: italic; margin-top: 1rem;">No RSVPs yet.</p>';
            }

            let html = '<div class="attendee-list">';

            if (attending.length > 0) {
                html += '<h6>Attending:</h6><div class="attendee-tags">';
                html += attending.map(a => `<span class="attendee-tag">${sanitizeHTML(a.name)}</span>`).join('');
                html += '</div>';
            }

            if (maybe.length > 0) {
                html += '<h6 style="margin-top: 0.75rem;">Maybe:</h6><div class="attendee-tags">';
                html += maybe.map(a => `<span class="attendee-tag maybe">${sanitizeHTML(a.name)}</span>`).join('');
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderCounterProposalSection(event) {
            return `
                <div class="counter-proposal-section">
                    <h6 style="color: var(--primary-color); margin-bottom: 0.5rem;">Propose Alternative Date/Time:</h6>
                    <form class="counter-proposal-form" onsubmit="submitCounterProposal(event, ${event.id})">
                        <input type="text" placeholder="Your name" required maxlength="50">
                        <input type="date" required min="${new Date().toISOString().split('T')[0]}">
                        <input type="time" required>
                        <button type="submit" class="btn" style="grid-column: span 3;">Suggest Alternative</button>
                    </form>
                    ${event.counterProposals.length > 0 ? renderCounterProposals(event.counterProposals) : ''}
                </div>
            `;
        }

        function renderCounterProposals(proposals) {
            let html = '<div class="counter-proposal-list">';
            html += '<h6 style="color: var(--primary-color); margin-top: 1rem; margin-bottom: 0.5rem;">Alternative Suggestions:</h6>';
            proposals.forEach(p => {
                const date = new Date(p.date + 'T' + p.time);
                const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                html += `
                    <div class="counter-proposal-item">
                        <strong>${sanitizeHTML(p.name)}</strong> suggests: ${dateStr} at ${p.time}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function rsvpToEvent(eventId, status) {
            const userName = prompt('Enter your name:');
            if (!userName || userName.trim() === '') {
                showNotification('Please enter your name to RSVP', 'error');
                return;
            }

            const nameValidation = validateMemberName(userName);
            if (!nameValidation.valid) {
                showNotification(nameValidation.error, 'error');
                return;
            }

            // Check if user is an approved member
            const isMember = approvedMembers.some(member =>
                member.name.toLowerCase() === nameValidation.name.toLowerCase()
            );

            if (!isMember) {
                showNotification(
                    `Only approved members can RSVP to events. "${nameValidation.name}" is not in our approved members list.`,
                    'error'
                );
                return;
            }

            const event = proposedEvents.find(e => e.id === eventId);
            if (!event) return;

            // Remove previous RSVP from this user if exists
            event.attendees = event.attendees.filter(a => a.name.toLowerCase() !== nameValidation.name.toLowerCase());

            // Add new RSVP if not "can't attend"
            if (status !== 'cant-attend') {
                event.attendees.push({
                    name: nameValidation.name,
                    status: status,
                    timestamp: new Date().toISOString()
                });
            }

            if (!saveEventsData()) {
                showNotification('Failed to save RSVP', 'error');
                return;
            }

            displayProposedEvents();

            const statusMessages = {
                'attending': `Great! ${nameValidation.name} is attending!`,
                'maybe': `${nameValidation.name} marked as maybe`,
                'cant-attend': `RSVP removed for ${nameValidation.name}`
            };

            showNotification(statusMessages[status] || 'RSVP updated', 'success');
        }

        function submitCounterProposal(e, eventId) {
            e.preventDefault();

            const form = e.target;
            const name = form.elements[0].value.trim();
            const date = form.elements[1].value;
            const time = form.elements[2].value;

            const nameValidation = validateMemberName(name);
            if (!nameValidation.valid) {
                showNotification(nameValidation.error, 'error');
                return;
            }

            // Check if user is an approved member
            const isMember = approvedMembers.some(member =>
                member.name.toLowerCase() === nameValidation.name.toLowerCase()
            );

            if (!isMember) {
                showNotification(
                    `Only approved members can propose alternative dates. "${nameValidation.name}" is not in our approved members list.`,
                    'error'
                );
                return;
            }

            const event = proposedEvents.find(ev => ev.id === eventId);
            if (!event) return;

            event.counterProposals.push({
                name: nameValidation.name,
                date: date,
                time: time,
                timestamp: new Date().toISOString()
            });

            if (!saveEventsData()) {
                showNotification('Failed to save counter-proposal', 'error');
                return;
            }

            displayProposedEvents();
            showNotification(`Alternative date proposed by ${nameValidation.name}!`, 'success');
        }

        function showEmailNotificationHelper(event) {
            // Get all approved members emails
            const emailList = approvedMembers.map(m => m.email).join(', ');

            const eventDate = new Date(event.date + 'T' + event.time);
            const dateStr = eventDate.toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });

            const emailSubject = `Puddingstone Club Event Proposal: ${dateStr}`;
            const emailBody = `Hi everyone,\n\n${event.proposer} has proposed a new gathering!\n\nDate: ${dateStr}\nTime: ${event.time}\nLocation: ${event.location}\n\nIdeas: ${event.ideas}\n\nPlease visit the Puddingstone Club website to RSVP!\n\nCheers,\nPuddingstone Club`;

            // Create temporary notification with email helper
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.maxWidth = '600px';

                notification.innerHTML = `
                    <div class="notification-content">
                        <div style="width: 100%;">
                            <div class="notification-icon">üìß</div>
                            <div style="margin-top: 1rem;">
                                <strong>Email Notification Helper</strong>
                                <p style="margin-top: 0.5rem; font-size: 0.9rem;">Copy the email list and message below to notify members:</p>

                                <div style="margin-top: 1rem;">
                                    <label style="font-size: 0.85rem; color: var(--text-light);">To:</label>
                                    <div class="email-list-display">${emailList || 'No approved members yet'}</div>
                                    <button class="btn" onclick="navigator.clipboard.writeText('${emailList}')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; margin-top: 0.25rem;">
                                        Copy Emails
                                    </button>
                                </div>

                                <div style="margin-top: 1rem;">
                                    <label style="font-size: 0.85rem; color: var(--text-light);">Subject:</label>
                                    <div class="email-list-display">${emailSubject}</div>
                                </div>

                                <div style="margin-top: 1rem;">
                                    <label style="font-size: 0.85rem; color: var(--text-light);">Message:</label>
                                    <div class="email-list-display" style="white-space: pre-wrap; font-family: inherit;">${emailBody}</div>
                                    <button class="btn" onclick="navigator.clipboard.writeText(\`${emailBody.replace(/`/g, '\\`')}\`)" style="padding: 0.4rem 0.8rem; font-size: 0.85rem; margin-top: 0.25rem;">
                                        Copy Message
                                    </button>
                                </div>

                                <button class="btn" onclick="this.closest('.notification').remove()" style="width: 100%; margin-top: 1rem; padding: 0.5rem;">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(notification);
            }, 500);
        }

        function saveEventsData() {
            try {
                localStorage.setItem('puddingstoneEvents', JSON.stringify(proposedEvents));
                return true;
            } catch (error) {
                console.error('Failed to save events data:', error);
                return false;
            }
        }

        function loadEventsData() {
            try {
                const stored = localStorage.getItem('puddingstoneEvents');
                if (stored) {
                    proposedEvents = JSON.parse(stored);
                    displayProposedEvents();
                }
            } catch (error) {
                console.error('Failed to load events data:', error);
                showNotification('Failed to load events data', 'warning');
            }
        }

        async function updateMembersListDisplay() {
            const container = document.getElementById('membersListDisplay');

            if (!container) {
                console.error('membersListDisplay container not found');
                return;
            }

            try {
                console.log('Loading members list...');
                const { data: members, error } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .order('name', { ascending: true });

                if (error) {
                    console.error('Supabase error:', error);
                    throw error;
                }

                console.log('Members loaded:', members);

                if (!members || members.length === 0) {
                    container.innerHTML = '<p class="empty-state">No members yet. Be the first to join!</p>';
                    return;
                }

                container.innerHTML = members.map(member => {
                    const sanitizedName = sanitizeHTML(member.name);
                    const sanitizedEmail = sanitizeHTML(member.email);

                    return `
                        <div class="member-item">
                            <div>
                                <span class="member-name">${sanitizedName}${member.is_admin ? ' <span style="color: var(--gold-accent); font-size: 0.85rem;">(Admin)</span>' : ''}</span>
                                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.25rem;">${sanitizedEmail}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading members list:', error);
                container.innerHTML = `
                    <p class="empty-state">Error loading members. Please check the console for details.</p>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;">${error.message}</p>
                `;
            }
        }

        // Photo Carousel Functions
        function initCarousel() {
            renderCarousel();
            renderGallery();
            startCarouselAutoRotate();
        }

        function renderCarousel() {
            const carouselInner = document.getElementById('carouselInner');
            const indicators = document.getElementById('carouselIndicators');

            if (!carouselInner) return;

            if (clubPhotos.length === 0) {
                carouselInner.innerHTML = `
                    <div class="carousel-item active">
                        <div class="carousel-placeholder">
                            <p>üì∏</p>
                            <p>Add photos via Admin panel</p>
                        </div>
                    </div>
                `;
                indicators.innerHTML = '';
                return;
            }

            carouselInner.innerHTML = clubPhotos.map((photo, index) => {
                const sanitizedCaption = photo.caption ? sanitizeHTML(photo.caption) : '';
                return `
                    <div class="carousel-item ${index === 0 ? 'active' : ''}">
                        <img src="${sanitizeHTML(photo.url)}" alt="${sanitizedCaption}" onerror="this.parentElement.innerHTML='<div class=carousel-placeholder><p>‚ùå</p><p>Image failed to load</p></div>'">
                    </div>
                `;
            }).join('');

            indicators.innerHTML = clubPhotos.map((_, index) =>
                `<button class="carousel-indicator ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></button>`
            ).join('');

            currentCarouselIndex = 0;
        }

        function moveCarousel(direction) {
            if (clubPhotos.length === 0) return;

            const items = document.querySelectorAll('.carousel-item');
            const indicators = document.querySelectorAll('.carousel-indicator');

            items[currentCarouselIndex].classList.remove('active');
            indicators[currentCarouselIndex]?.classList.remove('active');

            currentCarouselIndex = (currentCarouselIndex + direction + clubPhotos.length) % clubPhotos.length;

            items[currentCarouselIndex].classList.add('active');
            indicators[currentCarouselIndex]?.classList.add('active');

            // Reset auto-rotate timer
            resetCarouselAutoRotate();
        }

        function goToSlide(index) {
            if (clubPhotos.length === 0) return;

            const items = document.querySelectorAll('.carousel-item');
            const indicators = document.querySelectorAll('.carousel-indicator');

            items[currentCarouselIndex].classList.remove('active');
            indicators[currentCarouselIndex]?.classList.remove('active');

            currentCarouselIndex = index;

            items[currentCarouselIndex].classList.add('active');
            indicators[currentCarouselIndex]?.classList.add('active');

            resetCarouselAutoRotate();
        }

        function startCarouselAutoRotate() {
            if (clubPhotos.length <= 1) return;

            carouselInterval = setInterval(() => {
                moveCarousel(1);
            }, 5000); // Rotate every 5 seconds
        }

        function resetCarouselAutoRotate() {
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
            startCarouselAutoRotate();
        }

        // Gallery Functions
        function renderGallery() {
            const gallery = document.getElementById('photoGallery');

            if (!gallery) return;

            if (clubPhotos.length === 0) {
                gallery.innerHTML = `
                    <div class="gallery-placeholder">
                        <p style="font-size: 3rem; margin-bottom: 1rem;">üì∏</p>
                        <p>No photos yet</p>
                        <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">Admins can add photos via the Admin panel</p>
                    </div>
                `;
                return;
            }

            gallery.innerHTML = clubPhotos.map((photo, index) => {
                const sanitizedCaption = photo.caption ? sanitizeHTML(photo.caption) : `Photo ${index + 1}`;
                return `
                    <div class="gallery-item" onclick="openLightbox('${sanitizeHTML(photo.url)}')">
                        <img src="${sanitizeHTML(photo.url)}" alt="${sanitizedCaption}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'225\'%3E%3Crect fill=\'%23ddd\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' dominant-baseline=\'middle\' text-anchor=\'middle\' font-family=\'sans-serif\' font-size=\'18\' fill=\'%23999\'%3EImage Error%3C/text%3E%3C/svg%3E'">
                        ${photo.caption ? `<div class="gallery-item-caption">${sanitizedCaption}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Lightbox Functions
        function openLightbox(imageUrl) {
            const lightbox = document.getElementById('photoLightbox');
            const lightboxImage = document.getElementById('lightboxImage');

            lightboxImage.src = imageUrl;
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            const lightbox = document.getElementById('photoLightbox');
            lightbox.classList.remove('active');
        }

        // Photo Upload Functions
        function showPhotoUploadModal() {
            if (!currentUser) {
                showNotification('Please sign in to upload photos', 'error');
                document.querySelector('[data-section="auth"]').click();
                return;
            }

            const modal = document.getElementById('photoUploadModal');
            modal.style.display = 'flex';

            // Reset form
            document.getElementById('photoUploadForm').reset();
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('captionCharCount').textContent = '0';

            // Add file preview listener
            const fileInput = document.getElementById('photoFile');
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('photoPreviewImg').src = e.target.result;
                        document.getElementById('photoPreview').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Add caption character counter
            const captionInput = document.getElementById('photoUploadCaption');
            captionInput.oninput = function() {
                document.getElementById('captionCharCount').textContent = this.value.length;
            };
        }

        function closePhotoUploadModal() {
            const modal = document.getElementById('photoUploadModal');
            modal.style.display = 'none';
        }

        async function handlePhotoUpload(event) {
            event.preventDefault();

            if (!currentUser) {
                showNotification('Please sign in to upload photos', 'error');
                return;
            }

            const fileInput = document.getElementById('photoFile');
            const captionInput = document.getElementById('photoUploadCaption');
            const file = fileInput.files[0];

            if (!file) {
                showNotification('Please select a photo', 'error');
                return;
            }

            // Check file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Photo size must be less than 5MB', 'error');
                return;
            }

            // Check file type
            if (!file.type.startsWith('image/')) {
                showNotification('Please upload an image file', 'error');
                return;
            }

            const submitButton = event.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Uploading...';

            try {
                // Generate unique filename
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}-${currentUser.id}.${fileExt}`;
                const filePath = `${fileName}`;

                // Upload to Supabase Storage
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('photos')
                    .upload(filePath, file);

                if (uploadError) throw uploadError;

                // Insert photo metadata into database
                const { data: photoData, error: photoError } = await supabase
                    .from('photos')
                    .insert([
                        {
                            storage_path: filePath,
                            caption: captionInput.value.trim() || null,
                            uploaded_by: currentUser.id,
                            display_order: 0
                        }
                    ])
                    .select()
                    .single();

                if (photoError) throw photoError;

                showNotification('Photo uploaded successfully! It will appear after admin approval.', 'success');
                closePhotoUploadModal();

            } catch (error) {
                console.error('Photo upload error:', error);
                showNotification(error.message || 'Failed to upload photo. Please try again.', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Upload Photo';
            }
        }

        // Photo Management Functions

        function saveCaptionsData() {
            try {
                localStorage.setItem('puddingstoneCaptions', JSON.stringify(photoCaptions));
                return true;
            } catch (error) {
                console.error('Failed to save captions:', error);
                return false;
            }
        }

        async function loadPhotosData() {
            try {
                // Load approved photos from Supabase
                const { data: photos, error } = await supabase
                    .from('photos')
                    .select('*')
                    .eq('status', 'approved')
                    .order('display_order', { ascending: true })
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // Build club photos array with public URLs from Supabase
                const supabasePhotos = await Promise.all((photos || []).map(async (photo) => {
                    const { data: urlData } = supabase.storage
                        .from('photos')
                        .getPublicUrl(photo.storage_path);

                    return {
                        id: photo.id,
                        url: urlData.publicUrl,
                        caption: photo.caption || '',
                        addedDate: photo.created_at,
                        source: 'supabase'
                    };
                }));

                // Load captions from localStorage for legacy photos
                const storedCaptions = localStorage.getItem('puddingstoneCaptions');
                if (storedCaptions) {
                    photoCaptions = JSON.parse(storedCaptions);
                }

                // Add original photos from assets/photos/ directory
                const legacyPhotos = PHOTO_FILES.map((filename, index) => {
                    const url = `assets/photos/${filename}`;
                    return {
                        id: `legacy-${index}`,
                        url: url,
                        caption: photoCaptions[filename] || '',
                        addedDate: '2024-01-01', // Default date for legacy photos
                        source: 'legacy'
                    };
                });

                // Combine both sources - Supabase photos first, then legacy
                clubPhotos = [...supabasePhotos, ...legacyPhotos];

                renderCarousel();
                renderGallery();
            } catch (error) {
                console.error('Failed to load photos:', error);

                // Fallback to legacy photos only if Supabase fails
                try {
                    const storedCaptions = localStorage.getItem('puddingstoneCaptions');
                    if (storedCaptions) {
                        photoCaptions = JSON.parse(storedCaptions);
                    }

                    clubPhotos = PHOTO_FILES.map((filename, index) => {
                        const url = `assets/photos/${filename}`;
                        return {
                            id: `legacy-${index}`,
                            url: url,
                            caption: photoCaptions[filename] || '',
                            addedDate: '2024-01-01',
                            source: 'legacy'
                        };
                    });

                    renderCarousel();
                    renderGallery();
                } catch (fallbackError) {
                    console.error('Failed to load legacy photos:', fallbackError);
                }
            }
        }

        // Membership Request Functions
        function initMembershipForm() {
            const form = document.getElementById('membershipRequestForm');
            const messageField = document.getElementById('requestMessage');
            const charCount = document.getElementById('charCount');

            // Character counter
            if (messageField) {
                messageField.addEventListener('input', () => {
                    charCount.textContent = messageField.value.length;
                });
            }

            // Form submission
            if (form) {
                form.addEventListener('submit', handleMembershipRequest);
            }
        }

        async function handleMembershipRequest(e) {
            e.preventDefault();

            const name = document.getElementById('requestName').value.trim();
            const email = document.getElementById('requestEmail').value.trim();
            const phone = document.getElementById('requestPhone').value.trim();
            const message = document.getElementById('requestMessage').value.trim();

            // Validate name
            const nameValidation = validateMemberName(name);
            if (!nameValidation.valid) {
                showNotification(nameValidation.error, 'error');
                return;
            }

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }

            try {
                // Check for duplicate requests in Supabase
                const { data: existingRequests, error: checkError } = await supabase
                    .from('membership_requests')
                    .select('*')
                    .or(`email.ilike.${email},name.ilike.${nameValidation.name}`);

                if (checkError) throw checkError;

                if (existingRequests && existingRequests.length > 0) {
                    showNotification('A membership request already exists for this name or email', 'warning');
                    return;
                }

                // Insert request into Supabase
                const { data, error } = await supabase
                    .from('membership_requests')
                    .insert([
                        {
                            name: nameValidation.name,
                            email: email,
                            message: message
                        }
                    ])
                    .select();

                if (error) throw error;

                // Clear form
                document.getElementById('membershipRequestForm').reset();
                document.getElementById('charCount').textContent = '0';

                // Show success message
                showNotification('Membership request submitted successfully! We will review your application soon.', 'success');

                // Reload admin data if admin is viewing
                if (isAdminLoggedIn) {
                    await loadAdminData();
                }
            } catch (error) {
                console.error('Error submitting membership request:', error);
                showNotification('Failed to submit request. Please try again.', 'error');
            }
        }

        // Admin Functions
        async function loadAdminData() {
            await displayPendingRequests();
            await displayPendingPhotos();
            await displayApprovedMembers();
        }

        async function displayPendingRequests() {
            const container = document.getElementById('pendingRequests');

            try {
                const { data: pendingRequests, error } = await supabase
                    .from('membership_requests')
                    .select('*')
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!pendingRequests || pendingRequests.length === 0) {
                    container.innerHTML = '<p class="empty-state">No pending membership requests.</p>';
                    return;
                }

                container.innerHTML = pendingRequests.map(request => {
                    const date = new Date(request.created_at);
                    const sanitizedName = sanitizeHTML(request.name);
                    const sanitizedEmail = sanitizeHTML(request.email);
                    const sanitizedMessage = sanitizeHTML(request.message || 'No message provided');

                    return `
                        <div class="request-card">
                            <h4>${sanitizedName}</h4>
                            <p><strong>Email:</strong> ${sanitizedEmail}</p>
                            <div class="request-message">
                                <strong>Message:</strong><br>
                                ${sanitizedMessage}
                            </div>
                            <div class="request-meta">
                                Submitted: ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}
                            </div>
                            <div class="request-actions">
                                <button class="btn btn-approve" onclick="approveRequest('${request.id}')">‚úì Approve</button>
                                <button class="btn btn-deny" onclick="denyRequest('${request.id}')">‚úï Deny</button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading pending requests:', error);
                container.innerHTML = '<p class="empty-state">Error loading requests. Please try again.</p>';
            }
        }

        async function displayApprovedMembers() {
            const container = document.getElementById('approvedMembers');

            try {
                const { data: members, error } = await supabase
                    .from('user_profiles')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!members || members.length === 0) {
                    container.innerHTML = '<p class="empty-state">No registered members yet.</p>';
                    return;
                }

                container.innerHTML = members.map(member => {
                    const date = new Date(member.created_at);
                    const sanitizedName = sanitizeHTML(member.name);
                    const sanitizedEmail = sanitizeHTML(member.email);

                    return `
                        <div class="approved-member-card">
                            <div class="member-info">
                                <h4>${sanitizedName}${member.is_admin ? ' <span style="color: var(--gold-accent);">(Admin)</span>' : ''}</h4>
                                <p>${sanitizedEmail} ‚Ä¢ Joined ${date.toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading approved members:', error);
                container.innerHTML = '<p class="empty-state">Error loading members. Please try again.</p>';
            }
        }

        async function approveRequest(requestId) {
            try {
                // Update request status to approved
                const { error } = await supabase
                    .from('membership_requests')
                    .update({ status: 'approved' })
                    .eq('id', requestId);

                if (error) throw error;

                // Refresh displays
                await loadAdminData();
                showNotification('Membership request approved! The applicant can now create an account.', 'success');
            } catch (error) {
                console.error('Error approving request:', error);
                showNotification('Failed to approve request', 'error');
            }
        }

        async function denyRequest(requestId) {
            try {
                // Update request status to rejected
                const { error } = await supabase
                    .from('membership_requests')
                    .update({ status: 'rejected' })
                    .eq('id', requestId);

                if (error) throw error;

                // Refresh displays
                await loadAdminData();
                showNotification('Membership request denied', 'success');
            } catch (error) {
                console.error('Error denying request:', error);
                showNotification('Failed to deny request', 'error');
            }
        }

        async function displayPendingPhotos() {
            const container = document.getElementById('pendingPhotos');

            try {
                const { data: pendingPhotos, error } = await supabase
                    .from('photos')
                    .select('*, user_profiles(name)')
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!pendingPhotos || pendingPhotos.length === 0) {
                    container.innerHTML = '<p class="empty-state">No pending photos.</p>';
                    return;
                }

                const photoPromises = pendingPhotos.map(async (photo) => {
                    const date = new Date(photo.created_at);
                    const uploaderName = photo.user_profiles?.name || 'Unknown';
                    const sanitizedCaption = photo.caption ? sanitizeHTML(photo.caption) : '<em style="color: var(--text-light);">No caption</em>';

                    // Get public URL for the photo
                    const { data: urlData } = supabase.storage
                        .from('photos')
                        .getPublicUrl(photo.storage_path);

                    return `
                        <div class="request-card" style="position: relative;">
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                <img src="${urlData.publicUrl}" style="width: 200px; height: 150px; object-fit: cover; border-radius: 8px; border: 2px solid var(--border-color);" alt="Pending photo">
                                <div style="flex: 1;">
                                    <h4>Uploaded by: ${sanitizeHTML(uploaderName)}</h4>
                                    <p><strong>Caption:</strong> ${sanitizedCaption}</p>
                                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;">
                                        Uploaded: ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}
                                    </p>
                                </div>
                            </div>
                            <div class="request-actions">
                                <button class="btn btn-approve" onclick="approvePhoto('${photo.id}')">‚úì Approve</button>
                                <button class="btn btn-deny" onclick="rejectPhoto('${photo.id}')">‚úï Reject</button>
                            </div>
                        </div>
                    `;
                });

                const photoHTML = await Promise.all(photoPromises);
                container.innerHTML = photoHTML.join('');

            } catch (error) {
                console.error('Error loading pending photos:', error);
                container.innerHTML = '<p class="empty-state">Error loading photos. Please try again.</p>';
            }
        }

        async function approvePhoto(photoId) {
            try {
                const { error } = await supabase
                    .from('photos')
                    .update({ status: 'approved' })
                    .eq('id', photoId);

                if (error) throw error;

                await loadAdminData();
                // Refresh gallery to show new photo
                loadPhotosData();
                showNotification('Photo approved and published to gallery!', 'success');
            } catch (error) {
                console.error('Error approving photo:', error);
                showNotification('Failed to approve photo', 'error');
            }
        }

        async function rejectPhoto(photoId) {
            try {
                // Get photo info to delete from storage
                const { data: photo, error: fetchError } = await supabase
                    .from('photos')
                    .select('storage_path')
                    .eq('id', photoId)
                    .single();

                if (fetchError) throw fetchError;

                // Delete from storage
                const { error: storageError } = await supabase.storage
                    .from('photos')
                    .remove([photo.storage_path]);

                if (storageError) throw storageError;

                // Delete from database
                const { error: dbError } = await supabase
                    .from('photos')
                    .delete()
                    .eq('id', photoId);

                if (dbError) throw dbError;

                await loadAdminData();
                showNotification('Photo rejected and deleted', 'success');
            } catch (error) {
                console.error('Error rejecting photo:', error);
                showNotification('Failed to reject photo', 'error');
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication status first
            await checkAuthSession();

            initEventProposalForm();
            initMembershipForm();
            updateMembersListDisplay();
            loadEventsData();
            loadPhotosData();
            initCarousel();
        });
    </script>
</body>
</html>